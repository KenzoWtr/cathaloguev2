<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionnaire d'Inventaire</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #556B2F 0%, #3d4f21 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 30px;
            margin-bottom: 25px;
        }

        h1 {
            color: #556B2F;
            margin-bottom: 25px;
            font-size: 2rem;
        }

        .sync-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .sync-status.connected {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .sync-status.disconnected {
            background: #ffebee;
            color: #c62828;
        }

        .totals {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .total-card {
            padding: 20px;
            border-radius: 10px;
            border: 2px solid;
        }

        .total-card.buy {
            background: linear-gradient(135deg, #fee 0%, #fdd 100%);
            border-color: #fcc;
        }

        .total-card.sell {
            background: linear-gradient(135deg, #eef 0%, #ddf 100%);
            border-color: #ccf;
        }

        .total-card.profit {
            background: linear-gradient(135deg, #efe 0%, #dfd 100%);
            border-color: #cfc;
        }

        .total-label {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .buy .total-label { color: #c33; }
        .sell .total-label { color: #33c; }
        .profit .total-label { color: #3c3; }

        .total-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .buy .total-value { color: #a22; }
        .sell .total-value { color: #22a; }
        .profit .total-value { color: #2a2; }

        .search-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #556B2F;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: #ddd;
            color: #333;
        }

        .category-btn:hover {
            background: #ccc;
        }

        .category-btn.active {
            background: #556B2F;
            color: white;
        }

        .add-btn {
            padding: 12px 24px;
            background: #556B2F;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .add-btn:hover {
            background: #445520;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            color: #556B2F;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #556B2F;
        }

        .form-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #556B2F;
            color: white;
        }

        .btn-primary:hover {
            background: #445520;
        }

        .btn-secondary {
            background: #ddd;
            color: #333;
        }

        .btn-secondary:hover {
            background: #ccc;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .item-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .item-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            background: #f0f0f0;
        }

        .item-image.placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 3rem;
        }

        .item-title h3 {
            color: #333;
            margin-bottom: 8px;
        }

        .item-category {
            display: inline-block;
            background: #e8f5e9;
            color: #2e7d32;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            color: #666;
            transition: color 0.3s;
        }

        .icon-btn:hover {
            color: #333;
        }

        .icon-btn.edit:hover {
            color: #2196F3;
        }

        .icon-btn.delete:hover {
            color: #f44336;
        }

        .item-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
            min-height: 40px;
        }

        .item-details {
            border-top: 2px solid #f0f0f0;
            padding-top: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .detail-label {
            color: #666;
        }

        .detail-value {
            font-weight: 600;
        }

        .detail-value.buy { color: #c33; }
        .detail-value.sell { color: #33c; }
        .detail-value.profit { color: #2a2; }

        .detail-row.highlight {
            padding-top: 8px;
            border-top: 2px solid #f0f0f0;
            margin-top: 8px;
        }

        .empty-state {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .empty-state p {
            color: #999;
            font-size: 1.1rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .search-section {
                flex-direction: column;
            }
            
            .search-box {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">üîÑ Connexion √† Firebase...</div>

    <div class="container" id="app" style="display: none;">
        <div class="header">
            <h1>üõçÔ∏è Gestionnaire d'Inventaire</h1>
            <div class="sync-status connected" id="syncStatus">
                ‚úÖ Synchronis√© en temps r√©el
            </div>
            
            <div class="totals">
                <div class="total-card buy">
                    <div class="total-label">Total Prix d'Achat</div>
                    <div class="total-value" id="totalBuy">0.00 ‚Ç¨</div>
                </div>
                <div class="total-card sell">
                    <div class="total-label">Total Prix de Vente</div>
                    <div class="total-value" id="totalSell">0.00 ‚Ç¨</div>
                </div>
                <div class="total-card profit">
                    <div class="total-label">Chiffre d'Affaires</div>
                    <div class="total-value" id="totalProfit">0.00 ‚Ç¨</div>
                </div>
            </div>

            <div class="search-section">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="Rechercher un article...">
                </div>
                
                <div class="categories" id="categories">
                    <button class="category-btn active" data-category="Tous">Tous</button>
                    <button class="category-btn" data-category="Figurine">Figurine</button>
                    <button class="category-btn" data-category="Musique">Musique</button>
                    <button class="category-btn" data-category="V√™tement">V√™tement</button>
                    <button class="category-btn" data-category="Jeux vid√©o">Jeux vid√©o</button>
                    <button class="category-btn" data-category="Peluche">Peluche</button>
                    <button class="category-btn" data-category="Autres">Autres</button>
                </div>

                <button class="add-btn" onclick="openModal()">‚ûï Ajouter</button>
            </div>
        </div>

        <div class="items-grid" id="itemsGrid">
            <div class="empty-state">
                <p>Aucun article trouv√©. Ajoutez votre premier article !</p>
            </div>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nouvel Article</h2>
                <button class="close-btn" onclick="closeModal()">‚úï</button>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label>Nom *</label>
                    <input type="text" id="itemName" required>
                </div>
                <div class="form-group">
                    <label>Cat√©gorie</label>
                    <select id="itemCategory">
                        <option>Figurine</option>
                        <option>Musique</option>
                        <option>V√™tement</option>
                        <option>Jeux vid√©o</option>
                        <option>Peluche</option>
                        <option selected>Autres</option>
                    </select>
                </div>
                <div class="form-group full">
                    <label>Lien de l'image (URL)</label>
                    <input type="url" id="itemImage" placeholder="https://exemple.com/image.jpg">
                </div>
                <div class="form-group">
                    <label>Quantit√© *</label>
                    <input type="number" id="itemQuantity" min="0" required>
                </div>
                <div class="form-group">
                    <label>Prix d'Achat (‚Ç¨) *</label>
                    <input type="number" id="itemBuyPrice" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Prix de Revente (‚Ç¨) *</label>
                    <input type="number" id="itemSellPrice" min="0" step="0.01" required>
                </div>
                <div class="form-group full">
                    <label>Description</label>
                    <textarea id="itemDescription" rows="3"></textarea>
                </div>
            </div>

            <div class="form-actions">
                <button class="btn btn-primary" onclick="saveItem()">Enregistrer</button>
                <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDoBxIjbKxzl71KC60Cb5zZ6qxRqn4NNWg",
            authDomain: "stat-inventaire.firebaseapp.com",
            projectId: "stat-inventaire",
            storageBucket: "stat-inventaire.firebasestorage.app",
            messagingSenderId: "981837315742",
            appId: "1:981837315742:web:ce6424e96651fef3c1c58f"
        };

        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Variables globales
        let items = [];
        let editingId = null;
        let currentCategory = 'Tous';
        let searchTerm = '';

        // √âcouter les changements en temps r√©el
        const q = query(collection(db, "items"));
        onSnapshot(q, (snapshot) => {
            items = [];
            snapshot.forEach((doc) => {
                items.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            renderItems();
            updateTotals();
            
            // Cacher le loading et afficher l'app
            document.getElementById('loading').style.display = 'none';
            document.getElementById('app').style.display = 'block';
        });

        // Calculer et afficher les totaux
        function updateTotals() {
            const totalBuy = items.reduce((sum, item) => sum + (item.buyPrice * item.quantity), 0);
            const totalSell = items.reduce((sum, item) => sum + (item.sellPrice * item.quantity), 0);
            const profit = totalSell - totalBuy;

            document.getElementById('totalBuy').textContent = totalBuy.toFixed(2) + ' ‚Ç¨';
            document.getElementById('totalSell').textContent = totalSell.toFixed(2) + ' ‚Ç¨';
            document.getElementById('totalProfit').textContent = profit.toFixed(2) + ' ‚Ç¨';
        }

        // Filtrer et afficher les articles
        function renderItems() {
            const grid = document.getElementById('itemsGrid');
            const filtered = items.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    (item.description && item.description.toLowerCase().includes(searchTerm.toLowerCase()));
                const matchesCategory = currentCategory === 'Tous' || item.category === currentCategory;
                return matchesSearch && matchesCategory;
            });

            if (filtered.length === 0) {
                grid.innerHTML = '<div class="empty-state"><p>Aucun article trouv√©. Ajoutez votre premier article !</p></div>';
                return;
            }

            grid.innerHTML = filtered.map(item => {
                const unitProfit = item.sellPrice - item.buyPrice;
                const totalProfit = unitProfit * item.quantity;
                
                return `
                    <div class="item-card">
                        ${item.image ? 
                            `<img src="${item.image}" alt="${item.name}" class="item-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                             <div class="item-image placeholder" style="display:none;">üñºÔ∏è</div>` 
                            : 
                            `<div class="item-image placeholder">üñºÔ∏è</div>`
                        }
                        <div class="item-header">
                            <div class="item-title">
                                <h3>${item.name}</h3>
                                <span class="item-category">${item.category}</span>
                            </div>
                            <div class="item-actions">
                                <button class="icon-btn edit" onclick="window.editItem('${item.id}')">‚úèÔ∏è</button>
                                <button class="icon-btn delete" onclick="window.deleteItem('${item.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                        <p class="item-description">${item.description || 'Pas de description'}</p>
                        <div class="item-details">
                            <div class="detail-row">
                                <span class="detail-label">Quantit√©:</span>
                                <span class="detail-value">${item.quantity}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Prix d'achat:</span>
                                <span class="detail-value buy">${item.buyPrice.toFixed(2)} ‚Ç¨</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Prix de vente:</span>
                                <span class="detail-value sell">${item.sellPrice.toFixed(2)} ‚Ç¨</span>
                            </div>
                            <div class="detail-row highlight">
                                <span class="detail-label">Profit unitaire:</span>
                                <span class="detail-value profit">${unitProfit.toFixed(2)} ‚Ç¨</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Profit total:</span>
                                <span class="detail-value profit">${totalProfit.toFixed(2)} ‚Ç¨</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ouvrir le modal
        window.openModal = function() {
            document.getElementById('modal').classList.add('active');
            document.getElementById('modalTitle').textContent = editingId ? 'Modifier l\'article' : 'Nouvel Article';
        }

        // Fermer le modal
        window.closeModal = function() {
            document.getElementById('modal').classList.remove('active');
            editingId = null;
            clearForm();
        }

        // Vider le formulaire
        function clearForm() {
            document.getElementById('itemName').value = '';
            document.getElementById('itemCategory').value = 'Autres';
            document.getElementById('itemQuantity').value = '';
            document.getElementById('itemBuyPrice').value = '';
            document.getElementById('itemSellPrice').value = '';
            document.getElementById('itemDescription').value = '';
            document.getElementById('itemImage').value = '';
        }

        // Enregistrer un article
        window.saveItem = async function() {
            const name = document.getElementById('itemName').value.trim();
            const category = document.getElementById('itemCategory').value;
            const quantity = parseInt(document.getElementById('itemQuantity').value);
            const buyPrice = parseFloat(document.getElementById('itemBuyPrice').value);
            const sellPrice = parseFloat(document.getElementById('itemSellPrice').value);
            const description = document.getElementById('itemDescription').value.trim();
            const image = document.getElementById('itemImage').value.trim();

            if (!name || isNaN(quantity) || isNaN(buyPrice) || isNaN(sellPrice)) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }

            const itemData = {
                name,
                category,
                quantity,
                buyPrice,
                sellPrice,
                description,
                image
            };

            try {
                if (editingId) {
                    await updateDoc(doc(db, "items", editingId), itemData);
                } else {
                    await addDoc(collection(db, "items"), itemData);
                }
                closeModal();
            } catch (error) {
                alert('Erreur lors de l\'enregistrement : ' + error.message);
            }
        }

        // Modifier un article
        window.editItem = function(id) {
            const item = items.find(i => i.id === id);
            if (!item) return;

            editingId = id;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('itemQuantity').value = item.quantity;
            document.getElementById('itemBuyPrice').value = item.buyPrice;
            document.getElementById('itemSellPrice').value = item.sellPrice;
            document.getElementById('itemDescription').value = item.description || '';
            document.getElementById('itemImage').value = item.image || '';

            openModal();
        }

        // Supprimer un article
        window.deleteItem = async function(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cet article ?')) {
                try {
                    await deleteDoc(doc(db, "items", id));
                } catch (error) {
                    alert('Erreur lors de la suppression : ' + error.message);
                }
            }
        }

        // Recherche
        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchTerm = e.target.value;
            renderItems();
        });

        // Filtres par cat√©gorie
        document.getElementById('categories').addEventListener('click', (e) => {
            if (e.target.classList.contains('category-btn')) {
                document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                currentCategory = e.target.dataset.category;
                renderItems();
            }
        });

        // Fermer le modal en cliquant √† l'ext√©rieur
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });
    </script>
</body>
</html>
